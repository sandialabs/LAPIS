macro(AddPythonTest name)
  add_test(NAME ${name} WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR} COMMAND ${Python3_EXECUTABLE} ${name}.py)
endmacro()

IF(MLIR_ENABLE_BINDINGS_PYTHON)
  IF(NOT DEFINED Python3_EXECUTABLE)
    MESSAGE(WARNING "MLIR's python bindings were enabled, but Python3_EXECUTABLE is not set. Will not be able to enable LAPIS's python tests")
  ELSE()
    IF(LAPIS_HAS_TORCH_MLIR)
      MESSAGE(STATUS "Enabling LAPIS's torch-mlir based python tests")
      AddPythonTest(matadd)
      AddPythonTest(resnet18_static)
      AddPythonTest(resnet18_dynamic)
    ENDIF()
    IF(LAPIS_HAS_MPACT)
      MESSAGE(STATUS "Enabling LAPIS's MPACT based python tests")
      AddPythonTest(spmv_sparsetensor)
    ENDIF()
  ENDIF()
ENDIF()
